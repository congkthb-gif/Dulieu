<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ĐIỂM DANH</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
    * {box-sizing:border-box;}
    body {font-family: Arial, sans-serif; margin:0; padding:10px 0; transition:all 0.4s; min-height:100vh;}
    
    h1 {font-size:6vw; margin:8px 0; text-align:center; color:white; text-shadow:1px 1px 4px rgba(0,0,0,0.6);}

    .buttons {text-align:center; padding:12px 0;}
    .btn {
        width:85%; max-width:360px; margin:10px auto; display:block;
        padding:18px 0; font-size:6.5vw; font-weight:bold;
        border:none; border-radius:16px; color:white; cursor:pointer;
        box-shadow:0 5px 15px rgba(0,0,0,0.3);
    }
    .vao {background:#137333;}
    .ra {background:#d93025;}
    .active {transform:scale(1.05); box-shadow:0 0 30px gold !important;}

    #quet {
        width:90%; margin:18px auto; display:block; padding:18px;
        font-size:5.5vw; text-align:center; border-radius:16px;
        border:3px dashed rgba(255,255,255,0.7); background:rgba(255,255,255,0.18);
        color:white; caret-color:white;
    }
    #quet::placeholder {color:rgba(255,255,255,0.6); font-size:5vw;}

    table {width:100%; border-collapse:collapse; font-size:4.2vw; margin-top:10px;} /* ← chữ nhỏ hơn */
    th, td {padding:8px 4px; text-align:center;}
    th {background:#1a73e8; color:white; font-size:4.5vw;}
    td:nth-child(1) {text-align:left; font-weight:bold; font-size:4.6vw;} /* Họ tên */
    td:nth-child(3), td:nth-child(4) {font-size:4.4vw; color:#333;} /* Giờ vào/ra */
    .highlight {background:#fff3cd !important;}

    .mode-vao {background:#c0e0c8;}
    .mode-ra  {background:#f4c0b8;}

    #thongbao {position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.85); color:white; padding:20px 40px; font-size:6.5vw; border-radius:16px; display:none; z-index:999;}
</style>
</head>
<body class="mode-vao">

<h1>ĐIỂM DANH</h1>

<div class="buttons">
    <button id="btnVao" class="btn vao active">VÀO LÀM</button>
    <button id="btnRa"  class="btn ra">TAN LÀM</button>
</div>

<input type="text" id="quet" autofocus placeholder="QUÉT TẠI ĐÂY..." autocomplete="off">

<div id="thongbao">ĐÃ GỬI!</div>

<table id="bang">
    <thead>
        <tr>
            <th>Họ tên</th>
            <th>Ngày sinh</th>
            <th>Vào</th>
            <th>Ra</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
// === DÁN URL WEB APP CỦA BẠN VÀO ĐÂY ===
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxJsvpiAZLQ5ZyhiUfGyn2N4rYOtFdGAMpqGDehjf89tmTSHSgwaq7YJmX2b2dj5WUE/exec";

let cheDo = "vao";
let danhSach = {};

const input = document.getElementById("quet");
const btnVao = document.getElementById("btnVao");
const btnRa = document.getElementById("btnRa");
const thongbao = document.getElementById("thongbao");

btnVao.onclick = () => { cheDo = "vao"; update(); input.focus(); }
btnRa.onclick  = () => { cheDo = "ra"; update(); input.focus(); }

function update() {
    document.body.className = cheDo === "vao" ? "mode-vao" : "mode-ra";
    btnVao.classList.toggle("active", cheDo === "vao");
    btnRa.classList.toggle("active", cheDo === "ra");
}

function layThoiGian() {
    return new Date().toLocaleString('vi-VN', {day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit'});
}

input.addEventListener("input", function() {
    let raw = this.value.trim();
    if ((raw.match(/,/g) || []).length >= 2) {
        xuLy(raw);
        this.value = "";
    }
});

input.addEventListener("keydown", e => {
    if (e.key === "Enter" && input.value.trim()) {
        xuLy(input.value.trim());
        input.value = "";
    }
});

function xuLy(raw) {
    let clean = raw.replace(/^\d+\.\s*/, '');
    let parts = clean.split(',').map(p => p.trim());
    if (parts.length < 2) return;

    let hoTen = parts[0].toUpperCase();
    let ngaySinh = parts[1];
    let tg = layThoiGian();
    let loai = cheDo === "vao" ? "Vào làm" : "Ra về";

    let key = `${hoTen}|${ngaySinh}`;
    if (!danhSach[key]) danhSach[key] = {hoTen, ngaySinh, gioVao: "", gioRa: ""};
    if (cheDo === "vao") danhSach[key].gioVao = tg;
    else danhSach[key].gioRa = tg;

    fetch(WEB_APP_URL, {
        method: "POST",
        mode: "no-cors",
        body: JSON.stringify({hoTen, ngaySinh, loai})
    }).then(() => {
        thongbao.style.display = "block";
        setTimeout(() => thongbao.style.display = "none", 800);
    });

    hienThi();
}

function hienThi() {
    const tbody = document.querySelector("#bang tbody");
    tbody.innerHTML = "";
    Object.values(danhSach).forEach(p => {
        let tr = document.createElement("tr");
        tr.innerHTML = `
            <td style="text-align:left;">${p.hoTen}</td>
            <td>${p.ngaySinh}</td>
            <td>${p.gioVao || ""}</td>
            <td>${p.gioRa || ""}</td>
        `;
        tbody.appendChild(tr);
    });
}

update();
hienThi();
</script>
</body>
</html>
